<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
    <script src="alp.js"></script>
    <script src="https://unpkg.com/alpinejs" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link rel="stylesheet" href="style.css"></link>
  </head>
  <body x-data="myData">
    <div class="myForm">
      <div id="img"></div>
      <form>
        <div class="form">
          <div class="label">
            <div class="inner">
              <label for="fname" class="textBox">First name:</label>
            </div>
            <div class="inner">
              <input
                type="text"
                x-model="first_name"
                id="first_name"
                name="fname"
                class="form-control textBox"
              />
            </div>
          </div>
          <div class="label">
            <div class="inner">
              <label for="lname" class="textBox">Last name:</label>
            </div>
            <div class="inner">
              <input
                type="text"
                x-model="last_name"
                id="last_name"
                name="lname"
                class="form-control textBox"
              />
            </div>
          </div>
          <div class="label">
            <div class="inner">
              <label for="StuNo" class="textBox">Student Number:</label>
            </div>
            <div class="inner">
              <input
                type="text"
                x-model="stuNo"
                id="stuNo"
                name="StuNo"
                class="form-control textBox"
              />
            </div>
          </div>
        </div>
      </form>
    </div>
    <button x-on:click="upload">submit</button>


    <script>
      
      function setup() {
        noCanvas();
        const video = createCapture(VIDEO);
        video.size(260, 220);
              let button= document.getElementById("submit");
      
      let data={};
        button.addEventListener("click", async (event) => {
          let first_name=document.getElementById("fname").value;
      let last_name=document.getElementById("lname").value;
      let StuNo=document.getElementById("StuNo").value;
      let images=document.createElement('img');
      let image64="";
          video.loadPixels();
          //console.log(video.canvas.toDataURL())
          image64 = video.canvas.toDataURL();

          //image64 is binary data for image and can be sent and saved to database
          data = { first_name,last_name,StuNo, image64 };

          //console.log(data)
          images.src=data.image64;
          document.body.appendChild(images)

          //this is suppose to send the data with the API end point but it doesnt work at all
          axios 
          .get(`/api?first_name=${first_name}&last_name=${last_name}&StuNo=${StuNo}&image64=${image64}`)
          .then(result=>{
            result.data.message
          })



          /*const options = {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            query: JSON.stringify(data),
          };
          const response = await fetch("/api", options);
          const json = await response.json();
          
          //console.log(response.data);
          console.log(data);*/
        });
      }
      
      
    </script>
  </body>
</html>
